# ğŸ” RAG å¤šæä¾›å•†æ”¯æŒè¯´æ˜

## ğŸ“‹ æ”¯æŒæƒ…å†µæ€»è§ˆ

| æä¾›å•† | RAG æ”¯æŒ | Embedding æ¨¡å‹ | å‘é‡ç»´åº¦ | æˆæœ¬ | æ¨èåº¦ |
|--------|---------|---------------|---------|------|--------|
| **Google Gemini** | âœ… å®Œå…¨æ”¯æŒ | text-embedding-004 | 768 | å…è´¹ï¼ˆæœ‰é…é¢ï¼‰ | â­â­â­â­â­ |
| **OpenAI** | âœ… å®Œå…¨æ”¯æŒ | text-embedding-3-small | 1536 | $0.02/1M tokens | â­â­â­â­ |
| **DeepSeek** | âŒ ä¸æ”¯æŒ | - | - | - | - |
| **è‡ªå®šä¹‰/æœ¬åœ°** | âš ï¸ éƒ¨åˆ†æ”¯æŒ | å–å†³äºå®ç° | å–å†³äºæ¨¡å‹ | å…è´¹ | â­â­â­ |

---

## ğŸ¯ å„æä¾›å•†è¯¦ç»†è¯´æ˜

### 1. Google Geminiï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… å…è´¹ä½¿ç”¨ï¼ˆæœ‰æ¯æ—¥é…é¢ï¼‰
- âœ… è´¨é‡é«˜ï¼Œä¸“ä¸ºå¤šè¯­è¨€ä¼˜åŒ–
- âœ… ä¸ Gemini æ–‡æœ¬ç”Ÿæˆæ¨¡å‹é…åˆæœ€ä½³
- âœ… å®˜æ–¹ SDK æ”¯æŒï¼Œç¨³å®šå¯é 

**ç¼ºç‚¹ï¼š**
- âš ï¸ éœ€è¦ Google API Key
- âš ï¸ æœ‰æ¯æ—¥è¯·æ±‚é™åˆ¶

**é…ç½®ï¼š**
```typescript
{
  provider: 'google',
  apiKey: 'YOUR_GEMINI_API_KEY',
  model: 'gemini-2.0-flash-exp',
  useRAG: true
}
```

**Embedding æ¨¡å‹ï¼š** `text-embedding-004`
- å‘é‡ç»´åº¦ï¼š768
- æœ€å¤§è¾“å…¥ï¼š10,000 å­—ç¬¦
- å®šä»·ï¼šå…è´¹ï¼ˆæœ‰é…é¢é™åˆ¶ï¼‰

---

### 2. OpenAI

**ä¼˜ç‚¹ï¼š**
- âœ… è´¨é‡ä¼˜ç§€
- âœ… ç¨³å®šæ€§å¥½
- âœ… æ–‡æ¡£å®Œå–„

**ç¼ºç‚¹ï¼š**
- âš ï¸ éœ€è¦ä»˜è´¹
- âš ï¸ å‘é‡ç»´åº¦è¾ƒå¤§ï¼ˆ1536ï¼‰ï¼Œå­˜å‚¨å ç”¨æ›´å¤š

**é…ç½®ï¼š**
```typescript
{
  provider: 'openai',
  apiKey: 'YOUR_OPENAI_API_KEY',
  baseUrl: 'https://api.openai.com/v1',
  model: 'gpt-4o',
  useRAG: true
}
```

**Embedding æ¨¡å‹ï¼š** `text-embedding-3-small`
- å‘é‡ç»´åº¦ï¼š1536
- æœ€å¤§è¾“å…¥ï¼š8191 tokens
- å®šä»·ï¼š$0.02 / 1M tokens

**å¯é€‰æ¨¡å‹ï¼š**
- `text-embedding-3-small`ï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰
- `text-embedding-3-large`ï¼ˆè´¨é‡æ›´é«˜ï¼Œä½†æ›´è´µï¼‰
- `text-embedding-ada-002`ï¼ˆæ—§ç‰ˆï¼Œä¸æ¨èï¼‰

---

### 3. DeepSeek

**çŠ¶æ€ï¼š** âŒ ä¸æ”¯æŒ

**åŸå› ï¼š**
- DeepSeek å®˜æ–¹ç›®å‰ä¸æä¾› Embedding API
- åªæä¾›æ–‡æœ¬ç”Ÿæˆ API

**æ›¿ä»£æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨ Google Gemini çš„ Embedding + DeepSeek çš„æ–‡æœ¬ç”Ÿæˆ
2. ä½¿ç”¨æœ¬åœ° Embedding æ¨¡å‹ï¼ˆè§ä¸‹æ–‡ï¼‰
3. ç¦ç”¨ RAGï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹å¼

---

### 4. è‡ªå®šä¹‰/æœ¬åœ°æä¾›å•†

**æ”¯æŒæƒ…å†µï¼š** âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆéœ€è¦å…¼å®¹ OpenAI API æ ¼å¼ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- ä½¿ç”¨ Ollama ç­‰æœ¬åœ°æ¨¡å‹
- ä½¿ç”¨ç¬¬ä¸‰æ–¹ API æœåŠ¡
- ä½¿ç”¨ä¼ä¸šå†…éƒ¨ API

**è¦æ±‚ï¼š**
æä¾›å•†å¿…é¡»æ”¯æŒ OpenAI å…¼å®¹çš„ Embedding APIï¼š

```bash
POST /embeddings
Content-Type: application/json
Authorization: Bearer YOUR_API_KEY

{
  "model": "text-embedding",
  "input": "è¦åµŒå…¥çš„æ–‡æœ¬",
  "encoding_format": "float"
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "data": [
    {
      "embedding": [0.1, 0.2, 0.3, ...],
      "index": 0
    }
  ]
}
```

**é…ç½®ç¤ºä¾‹ï¼ˆOllamaï¼‰ï¼š**
```typescript
{
  provider: 'custom',
  apiKey: 'ollama', // Ollama ä¸éœ€è¦çœŸå® key
  baseUrl: 'http://localhost:11434/v1',
  model: 'llama3',
  useRAG: true
}
```

**æ¨èçš„æœ¬åœ° Embedding æ¨¡å‹ï¼š**
- `nomic-embed-text`ï¼ˆæ¨èï¼Œ768 ç»´ï¼‰
- `mxbai-embed-large`ï¼ˆ1024 ç»´ï¼‰
- `all-minilm`ï¼ˆ384 ç»´ï¼Œè½»é‡çº§ï¼‰

---

## ğŸ”„ åˆ‡æ¢æä¾›å•†çš„æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦è­¦å‘Š

**ä¸åŒæä¾›å•†çš„å‘é‡ä¸å…¼å®¹ï¼**

åŸå› ï¼š
1. **å‘é‡ç»´åº¦ä¸åŒ**ï¼šGoogle 768 ç»´ vs OpenAI 1536 ç»´
2. **å‘é‡ç©ºé—´ä¸åŒ**ï¼šä¸åŒæ¨¡å‹è®­ç»ƒçš„å‘é‡ç©ºé—´ä¸åŒ
3. **æ— æ³•æ¯”è¾ƒç›¸ä¼¼åº¦**ï¼šä¸åŒç©ºé—´çš„å‘é‡æ— æ³•è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦

### åˆ‡æ¢æä¾›å•†çš„æ­¥éª¤

1. **æ¸…é™¤æ—§çš„å‘é‡æ•°æ®**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
   const request = indexedDB.open('InkFlowDB', 5);
   request.onsuccess = () => {
       const db = request.result;
       const tx = db.transaction(['vectors'], 'readwrite');
       tx.objectStore('vectors').clear();
       console.log('å‘é‡æ•°æ®å·²æ¸…é™¤');
   };
   ```

2. **åˆ‡æ¢æä¾›å•†**
   - åœ¨åº”ç”¨è®¾ç½®ä¸­é€‰æ‹©æ–°çš„æä¾›å•†
   - é…ç½®ç›¸åº”çš„ API Key

3. **é‡æ–°ç´¢å¼•å†…å®¹**
   - æ‰“å¼€æ¯ä¸ªç« èŠ‚ï¼Œç‚¹å‡»"ç´¢å¼•ç« èŠ‚"
   - æˆ–ä½¿ç”¨æ‰¹é‡ç´¢å¼•åŠŸèƒ½ï¼ˆå¦‚æœæœ‰ï¼‰

---

## ğŸ’° æˆæœ¬å¯¹æ¯”

### åœºæ™¯ï¼šç´¢å¼• 100 ç« å°è¯´

å‡è®¾æ¯ç«  3000 å­—ï¼Œæ€»è®¡ 300,000 å­—

| æä¾›å•† | Embedding æˆæœ¬ | å­˜å‚¨å ç”¨ | æ€»æˆæœ¬ |
|--------|---------------|---------|--------|
| **Google Gemini** | $0ï¼ˆå…è´¹ï¼‰ | ~230 KB | $0 |
| **OpenAI** | ~$0.006 | ~460 KB | $0.006 |
| **æœ¬åœ°æ¨¡å‹** | $0ï¼ˆç”µè´¹å¿½ç•¥ï¼‰ | ~230 KB | $0 |

### åœºæ™¯ï¼šæ¯å¤©ç”Ÿæˆ 10 ç« ï¼ˆä½¿ç”¨ RAGï¼‰

æ¯æ¬¡ç”Ÿæˆéœ€è¦æ£€ç´¢ 3 ç« ï¼Œæ¯ç« éœ€è¦ç”Ÿæˆ 1 æ¬¡æŸ¥è¯¢å‘é‡

| æä¾›å•† | æ¯æ—¥ Embedding æˆæœ¬ | æ¯æœˆæˆæœ¬ |
|--------|-------------------|---------|
| **Google Gemini** | $0ï¼ˆå…è´¹ï¼‰ | $0 |
| **OpenAI** | ~$0.0002 | ~$0.006 |
| **æœ¬åœ°æ¨¡å‹** | $0 | $0 |

**ç»“è®ºï¼š** Embedding æˆæœ¬éå¸¸ä½ï¼Œä¸»è¦æˆæœ¬åœ¨æ–‡æœ¬ç”Ÿæˆ

---

## ğŸ› ï¸ æœ¬åœ° Embedding æ¨¡å‹è®¾ç½®

### ä½¿ç”¨ Ollamaï¼ˆæ¨èï¼‰

1. **å®‰è£… Ollama**
   ```bash
   # macOS/Linux
   curl -fsSL https://ollama.com/install.sh | sh
   
   # Windows
   # ä¸‹è½½å®‰è£…åŒ…ï¼šhttps://ollama.com/download
   ```

2. **ä¸‹è½½ Embedding æ¨¡å‹**
   ```bash
   ollama pull nomic-embed-text
   ```

3. **é…ç½® InkFlow**
   ```typescript
   {
     provider: 'custom',
     apiKey: 'ollama',
     baseUrl: 'http://localhost:11434/v1',
     model: 'llama3', // ç”¨äºæ–‡æœ¬ç”Ÿæˆ
     useRAG: true
   }
   ```

4. **æµ‹è¯• Embedding**
   ```bash
   curl http://localhost:11434/v1/embeddings \
     -H "Content-Type: application/json" \
     -d '{
       "model": "nomic-embed-text",
       "input": "æµ‹è¯•æ–‡æœ¬"
     }'
   ```

---

## ğŸ”§ æ•…éšœæ’é™¤

### Q1: OpenAI Embedding å¤±è´¥

**é”™è¯¯ï¼š** `OpenAI Embedding API error: 401 Unauthorized`

**è§£å†³ï¼š**
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ API Key æœ‰ Embedding æƒé™
3. æ£€æŸ¥è´¦æˆ·ä½™é¢

---

### Q2: è‡ªå®šä¹‰æä¾›å•† Embedding å¤±è´¥

**é”™è¯¯ï¼š** `Custom embedding API error: 404 Not Found`

**è§£å†³ï¼š**
1. ç¡®è®¤ baseUrl æ­£ç¡®ï¼ˆéœ€è¦åŒ…å« `/v1`ï¼‰
2. ç¡®è®¤æä¾›å•†æ”¯æŒ `/embeddings` ç«¯ç‚¹
3. æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®

---

### Q3: å‘é‡æ£€ç´¢ç»“æœä¸å‡†ç¡®

**å¯èƒ½åŸå› ï¼š**
1. ä½¿ç”¨äº†ä¸åŒæä¾›å•†çš„å‘é‡ï¼ˆä¸å…¼å®¹ï¼‰
2. ç´¢å¼•çš„å†…å®¹å¤ªå°‘ï¼ˆ< 10 ç« ï¼‰
3. æŸ¥è¯¢æ–‡æœ¬ä¸å†…å®¹å·®å¼‚å¤ªå¤§

**è§£å†³ï¼š**
1. æ¸…é™¤å‘é‡æ•°æ®å¹¶é‡æ–°ç´¢å¼•
2. ç´¢å¼•æ›´å¤šå†…å®¹
3. ä¼˜åŒ–ç« èŠ‚æ‘˜è¦çš„è´¨é‡

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### Embedding ç”Ÿæˆé€Ÿåº¦

| æä¾›å•† | å¹³å‡å»¶è¿Ÿ | æ‰¹é‡å¤„ç† |
|--------|---------|---------|
| **Google Gemini** | ~200ms | æ”¯æŒ |
| **OpenAI** | ~150ms | æ”¯æŒ |
| **æœ¬åœ°æ¨¡å‹** | ~50ms | æ”¯æŒ |

### æ£€ç´¢è´¨é‡ï¼ˆä¸»è§‚è¯„åˆ†ï¼‰

| æä¾›å•† | ä¸­æ–‡è´¨é‡ | è‹±æ–‡è´¨é‡ | å¤šè¯­è¨€ |
|--------|---------|---------|--------|
| **Google Gemini** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **OpenAI** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **æœ¬åœ°æ¨¡å‹** | â­â­â­ | â­â­â­â­ | â­â­â­ |

---

## ğŸ¯ æ¨èé…ç½®

### ä¸ªäººç”¨æˆ·ï¼ˆå…è´¹ä¼˜å…ˆï¼‰
```typescript
{
  provider: 'google',
  apiKey: 'YOUR_GEMINI_API_KEY',
  model: 'gemini-2.0-flash-exp',
  useRAG: true
}
```

### ä¸“ä¸šç”¨æˆ·ï¼ˆè´¨é‡ä¼˜å…ˆï¼‰
```typescript
{
  provider: 'openai',
  apiKey: 'YOUR_OPENAI_API_KEY',
  model: 'gpt-4o',
  useRAG: true
}
```

### éšç§ä¼˜å…ˆç”¨æˆ·ï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰
```typescript
{
  provider: 'custom',
  apiKey: 'ollama',
  baseUrl: 'http://localhost:11434/v1',
  model: 'llama3',
  useRAG: true
}
```

### æ··åˆæ–¹æ¡ˆï¼ˆæœ€ä½³æ€§ä»·æ¯”ï¼‰
- **Embedding**ï¼šGoogle Geminiï¼ˆå…è´¹ï¼‰
- **æ–‡æœ¬ç”Ÿæˆ**ï¼šDeepSeekï¼ˆä¾¿å®œï¼‰

é…ç½®æ–¹æ³•ï¼š
1. ä½¿ç”¨ Google æä¾›å•†è¿›è¡Œç´¢å¼•
2. åˆ‡æ¢åˆ° DeepSeek è¿›è¡Œæ–‡æœ¬ç”Ÿæˆ
3. RAG æ£€ç´¢ä»ç„¶ä½¿ç”¨ Google çš„å‘é‡

---

## ğŸš€ æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤š Embedding æ¨¡å‹
- [ ] å‘é‡ç»´åº¦è‡ªåŠ¨è½¬æ¢
- [ ] æ··åˆæ£€ç´¢ï¼ˆå¤šä¸ªæä¾›å•†ï¼‰
- [ ] æœ¬åœ°å‘é‡æ•°æ®åº“ï¼ˆChromaã€Qdrantï¼‰
- [ ] å‘é‡å‹ç¼©ï¼ˆå‡å°‘å­˜å‚¨ï¼‰

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ° RAG ç›¸å…³é—®é¢˜ï¼š

1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤æä¾›å•†å’Œ API Key é…ç½®æ­£ç¡®
3. å°è¯•æ¸…é™¤å‘é‡æ•°æ®å¹¶é‡æ–°ç´¢å¼•
4. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†

---

**æ€»ç»“ï¼š** ç°åœ¨ RAG åŠŸèƒ½æ”¯æŒ Google Gemini å’Œ OpenAIï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¼å®¹ OpenAI API çš„è‡ªå®šä¹‰æä¾›å•†ã€‚æ¨èä½¿ç”¨ Google Geminiï¼ˆå…è´¹ä¸”è´¨é‡å¥½ï¼‰æˆ–æœ¬åœ°æ¨¡å‹ï¼ˆéšç§å’Œæˆæœ¬è€ƒè™‘ï¼‰ã€‚
